<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuickBlast Pro - é‚®ä»¶ç¾¤å‘å·¥å…·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-900 text-white min-h-screen font-sans p-6">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div class="space-y-6">
            <div class="flex items-center space-x-2 mb-4">
                <div class="bg-indigo-600 p-2 rounded-lg">ğŸš€</div>
                <h1 class="text-2xl font-bold tracking-wider">QUICKBLAST <span class="text-indigo-400 text-sm">PRO</span></h1>
            </div>

            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-lg relative">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-sm font-semibold text-indigo-400 uppercase tracking-wide">1. è¿æ¥é…ç½® (EmailJS)</h2>
                    <span class="text-xs text-green-400 hidden" id="savedBadge">âœ¨ å·²è‡ªåŠ¨è¯»å–é…ç½®</span>
                </div>
                <div class="space-y-3">
                    <input type="text" id="serviceId" placeholder="Service ID (ä¾‹å¦‚ service_xxx)" class="w-full bg-slate-900 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:outline-none transition">
                    <input type="text" id="templateId" placeholder="Template ID (ä¾‹å¦‚ template_xxx)" class="w-full bg-slate-900 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:outline-none transition">
                    <input type="password" id="publicKey" placeholder="Public Key (API Key)" class="w-full bg-slate-900 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:outline-none transition">
                </div>
                <div class="mt-4 bg-indigo-900/30 p-3 rounded text-xs text-indigo-200">
                    <p>ğŸ’¡ æç¤º: ç³»ç»Ÿä¼šè‡ªåŠ¨è®°ä½ä½ çš„é…ç½®ï¼Œä¸‹æ¬¡æ— éœ€é‡æ–°è¾“å…¥ã€‚</p>
                </div>
            </div>

            <div class="bg-slate-800 rounded-xl p-6 border border-slate-700 shadow-lg">
                <h2 class="text-sm font-semibold text-indigo-400 mb-4 uppercase tracking-wide">2. é‚®ä»¶å†…å®¹</h2>
                <div class="space-y-3">
                    <input type="text" id="emailSubject" placeholder="é‚®ä»¶æ ‡é¢˜" class="w-full bg-slate-900 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:outline-none">
                    <textarea id="emailBody" rows="6" placeholder="é‚®ä»¶æ­£æ–‡å†…å®¹..." class="w-full bg-slate-900 border border-slate-700 rounded p-3 text-sm focus:border-indigo-500 focus:outline-none"></textarea>
                </div>
            </div>
        </div>

        <div class="space-y-6 flex flex-col h-full">
            
            <div class="bg-white text-slate-900 rounded-xl p-6 shadow-lg flex-1">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-sm font-bold uppercase text-slate-500">3. ç›®æ ‡é‚®ç®±åˆ—è¡¨</h2>
                    <span id="countBadge" class="bg-indigo-100 text-indigo-800 text-xs px-2 py-1 rounded-full">0 ä¸ªè”ç³»äºº</span>
                </div>
                <textarea id="emailList" class="w-full h-48 bg-slate-50 border border-slate-200 rounded p-3 text-sm font-mono focus:border-indigo-500 focus:outline-none resize-none" placeholder="åœ¨æ­¤ç²˜è´´é‚®ç®±åœ°å€ï¼Œä¸€è¡Œä¸€ä¸ª...&#10;user1@example.com&#10;user2@example.com"></textarea>
                <p class="text-xs text-slate-400 mt-2 text-right">æ”¯æŒæ‰¹é‡ç²˜è´´ï¼Œè‡ªåŠ¨è¿‡æ»¤ç©ºè¡Œ</p>
            </div>

            <div class="bg-slate-950 rounded-xl p-6 border border-slate-800 flex-1 flex flex-col shadow-2xl relative overflow-hidden">
                <div class="flex justify-between items-center mb-4 z-10">
                    <h2 class="text-sm font-semibold text-white">å‘é€é˜Ÿåˆ—ç›‘æ§</h2>
                    <button onclick="clearLog()" class="text-xs text-slate-500 hover:text-white transition">æ¸…é™¤è®°å½•</button>
                </div>
                
                <div id="logWindow" class="flex-1 overflow-y-auto font-mono text-xs space-y-2 mb-4 p-2 bg-slate-900/50 rounded h-40">
                    <div class="text-slate-500 italic">>> ç­‰å¾…ä»»åŠ¡å¼€å§‹...</div>
                </div>

                <div class="w-full bg-slate-800 rounded-full h-1.5 mb-4 overflow-hidden">
                    <div id="progressBar" class="bg-indigo-500 h-1.5 rounded-full" style="width: 0%"></div>
                </div>

                <button id="sendBtn" onclick="startSending()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold py-4 rounded-lg shadow-lg transform transition active:scale-95 flex items-center justify-center space-x-2 z-10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
                    </svg>
                    <span>å¼€å¯çœŸå®å‘é€æ¨¡å¼</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒåŠŸèƒ½ï¼šè‡ªåŠ¨ä¿å­˜ä¸åŠ è½½é…ç½® ---
        window.onload = function() {
            const savedService = localStorage.getItem('qb_service_id');
            const savedTemplate = localStorage.getItem('qb_template_id');
            const savedKey = localStorage.getItem('qb_public_key');

            if (savedService) document.getElementById('serviceId').value = savedService;
            if (savedTemplate) document.getElementById('templateId').value = savedTemplate;
            if (savedKey) document.getElementById('publicKey').value = savedKey;

            if (savedService && savedTemplate && savedKey) {
                document.getElementById('savedBadge').classList.remove('hidden');
            }
        };

        function saveConfig() {
            const serviceId = document.getElementById('serviceId').value.trim();
            const templateId = document.getElementById('templateId').value.trim();
            const publicKey = document.getElementById('publicKey').value.trim();

            if (serviceId) localStorage.setItem('qb_service_id', serviceId);
            if (templateId) localStorage.setItem('qb_template_id', templateId);
            if (publicKey) localStorage.setItem('qb_public_key', publicKey);
        }
        // ------------------------------------

        document.getElementById('emailList').addEventListener('input', function(e) {
            const lines = e.target.value.split('\n').filter(line => line.trim() !== '');
            document.getElementById('countBadge').innerText = `${lines.length} ä¸ªè”ç³»äºº`;
        });

        const logWindow = document.getElementById('logWindow');
        const progressBar = document.getElementById('progressBar');

        function addLog(msg, type = 'info') {
            const div = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            if (type === 'success') div.className = 'text-green-400';
            else if (type === 'error') div.className = 'text-red-400';
            else div.className = 'text-slate-300';
            
            div.innerHTML = `<span class="opacity-50">[${timestamp}]</span> ${msg}`;
            logWindow.appendChild(div);
            logWindow.scrollTop = logWindow.scrollHeight;
        }

        function clearLog() {
            logWindow.innerHTML = '';
        }

        async function startSending() {
            // 1. è·å–é…ç½®
            const serviceId = document.getElementById('serviceId').value.trim();
            const templateId = document.getElementById('templateId').value.trim();
            const publicKey = document.getElementById('publicKey').value.trim();
            
            const subject = document.getElementById('emailSubject').value;
            const message = document.getElementById('emailBody').value;
            const emailText = document.getElementById('emailList').value;

            // 2. éªŒè¯
            if (!serviceId || !templateId || !publicKey) {
                alert('è¯·å…ˆå¡«å†™å®Œæ•´çš„ EmailJS é…ç½®ä¿¡æ¯ (ID å’Œ Key)');
                return;
            }
            if (!emailText.trim()) {
                alert('è¯·è¾“å…¥ç›®æ ‡é‚®ç®±åœ°å€');
                return;
            }

            // ä¿å­˜é…ç½®åˆ°æœ¬åœ°ç¼“å­˜
            saveConfig();

            // åˆå§‹åŒ– EmailJS
            emailjs.init(publicKey);

            const emails = emailText.split('\n').filter(line => line.trim() !== '');
            const total = emails.length;
            
            const btn = document.getElementById('sendBtn');
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            btn.innerText = 'å‘é€ä¸­...';
            
            clearLog();
            addLog(`ğŸš€ ä»»åŠ¡å¼€å§‹ï¼Œå…± ${total} å°é‚®ä»¶`);

            for (let i = 0; i < total; i++) {
                const email = emails[i].trim();
                
                try {
                    await emailjs.send(serviceId, templateId, {
                        to_email: email,
                        to_name: email.split('@')[0],
                        subject: subject,
                        message: message
                    });
                    
                    addLog(`âœ… å‘é€æˆåŠŸ: ${email}`, 'success');
                } catch (error) {
                    console.error(error);
                    addLog(`âŒ å‘é€å¤±è´¥: ${email} - ${error.text || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                }

                const percent = Math.round(((i + 1) / total) * 100);
                progressBar.style.width = `${percent}%`;

                // å¼ºåˆ¶é—´éš” 500msï¼Œé˜²æ­¢è§¦å‘é™åˆ¶
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            addLog('ğŸ æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼');
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            btn.innerText = 'å¼€å¯çœŸå®å‘é€æ¨¡å¼';
        }
    </script>
</body>
</html>
